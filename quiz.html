<style>
    #screen {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .top-bar-title {
      font-size: var(--size-h3);
      font-weight: 700;
    }

    .top-bar.has-title {
      justify-content: center;
    }

    .divider {
      height: 1px;
      width: 100%;
      background: #d1d5db;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    /* Pantallas y Animaciones */
    .screen-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      overflow: hidden;
      /* el contenido interno decide si hace scroll */
    }

    .screen {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.35s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Componentes: Intro */
    .intro-title {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      font-size: var(--size-h1);
      line-height: 1.2;
      margin: 8px 0 10px;
      color: var(--accent);
    }

    .intro-subtitle {
      font-size: 0.96rem;
      color: var(--text-muted);
      max-width: 540px;
      margin-bottom: 32px;
    }

    /* Componentes: Botones Principales */
    .btn-main {
      min-width: 210px;
      padding: 12px 28px;
      border-radius: 32px;
      border: none;
      background: var(--accent);
      color: #ffffff;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: var(--shadow-frame);
      transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.12s ease, border-color 0.12s ease;
    }

    .btn-main:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
      background: #803AFF;
      border-color: #803AFF;
    }

    .btn-main:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.18);
      background: var(--brand);
      border-color: var(--brand);
    }

    /* Componentes: Countdown */
    .countdown-number {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      font-size: 3.4rem;
      font-weight: 700;
      margin-top: 10px;
      animation: pop 0.6s ease-out;
      color: var(--accent);
    }

    @keyframes pop {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }

      40% {
        transform: scale(1.1);
        opacity: 1;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Componentes: Layout de Preguntas */
    .question-layout {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 12px;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .progress-label {
      font-weight: 600;
      color: var(--text-main);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: var(--radius-pill);
      background: #e5e7eb;
      overflow: hidden;
      margin-top: 4px;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: #5B00FF;
      transition: width 0.25s ease;
    }

    .timer {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.82rem;
    }

    .timer-number {
      font-weight: 700;
    }

    .timer-bar {
      position: relative;
      width: 110px;
      height: 8px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .timer-fill {
      position: absolute;
      inset: 0;
      width: 100%;
      background: #5B00FF;
      transition: width 3s linear;
    }

    .question-word-box {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0 20px;
      overflow: hidden;
    }

    .question-word {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      font-size: 2.6rem;
      font-weight: 700;
      padding: 16px 40px;
      border-radius: 18px;
      background: #ffffff;
      border: 1px solid #6E1EFF;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.16);
    }

    .options-grid {
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .option-btn {
      min-width: 110px;
      padding: 9px 18px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background: var(--fondo);
      color: #4a2800;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease, color 0.12s ease;
    }

    .option-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.25);
      background: #d4d4d4;
      border-color: #803AFF;
    }

    .option-btn.correct {
      background: #ECFDF5;
      border-color: var(--success);
      color: #166534;
    }

    .option-btn.wrong {
      background: #FEF2F2;
      border-color: var(--error);
      color: #b91c1c;
    }

    .question-footer {
      display: flex;
      justify-content: center;
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-top: auto;
    }

    /* Componentes: Feedback (Toast) */
    .feedback {
      position: absolute;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(17, 24, 39, 0.96);
      color: #f9fafb;
      font-size: 0.78rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease;
      white-space: nowrap;
    }

    .feedback.show {
      opacity: 1;
    }

    .feedback.success {
      background: var(--success);
    }

    .feedback.error {
      background: var(--error);
    }

    .results-text {
      font-size: 0.96rem;
      color: var(--template);
      max-width: 460px;
      margin: 0 auto 20px;
    }

    .results-grid {
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .result-card {
      min-width: 130px;
      padding: 10px 16px;
      border-radius: 14px;
      background: #ffffff;
      border: 1px solid var(--border);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
      text-align: center;
      font-size: 0.86rem;
    }

    .result-card strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 2px;
    }

    .btn-secondary {
      min-width: 190px;
      padding: 10px 24px;
      border-radius: 26px;
      border: none;
      background: var(--accent);
      color: #f9fafb;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.18);
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .btn-secondary:hover {
      background: #803AFF;
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.24);
    }

    .btn-secondary:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.18);
      background: var(--brand);
    }

    /* Modo Embebido (Configuración A) */

    html.embedded-mode .inner-card {
      border-radius: var(--radius-card);
    }

    /* Responsive Principal (Configuración A) */
    @media (max-width: 900px) {
      .app-content {
        padding: 16px 20px 22px;
      }

      .question-word {
        font-size: 2.1rem;
        padding: 14px 26px;
      }
    }

    /* Specific Layout for Mobile/Small Screens (< 760px) - Versión Clasificación */
    @media screen and (max-width: 700px) {

      .inner-card {
        display: flex !important;
        flex-direction: column !important;
      }

      .app-content {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        padding-bottom: 0 !important;
      }

   }
  </style>
</head>

<body>
  <div class="app-root">
    <div class="frame">
      <div class="inner-card">
        <div class="app-content">
          <div id="screen"></div>
          <div id="feedback" class="feedback"></div>
        </div>
      </div>
    </div>
  </div>


  <script>
    // Marcar modo embebido si está dentro de un iframe
    (function markEmbeddedMode() {
      try {
        if (window.self !== window.top) {
          document.documentElement.classList.add("embedded-mode");
        }
      } catch (e) {
        /* ignore */
      }
    })();

    // ===============================
    // CONFIGURACIÓN DEL LOGO
    // ===============================
    const LOGO_SRC = "../Nivel_A1/images/Logo_Arukay_Actualizado.png";
    const LOGO_ALT = "LOGO";
    const LOGO_HTML = `
      <div class="logo">
        <img src="${LOGO_SRC}" alt="${LOGO_ALT}" class="logo-img">
      </div>
    `;

    // ===============================
    // CONFIGURACIÓN DEL QUIZ
    // ===============================
    const QUESTION_TIME = 3; // segundos por pregunta

    const QUESTIONS = [
      {
        word: "ROJO",
        color: "#16a34a", // verde
        options: ["Rojo", "Verde", "Azul"],
        answer: "Verde"
      },
      {
        word: "AZUL",
        color: "#ea580c", // naranja
        options: ["Amarillo", "Naranja", "Azul"],
        answer: "Naranja"
      },
      {
        word: "VERDE",
        color: "#ef4444", // rojo
        options: ["Rojo", "Morado", "Verde"],
        answer: "Rojo"
      },
      {
        word: "AMARILLO",
        color: "#4f46e5", // morado/azul
        options: ["Violeta", "Negro", "Blanco"],
        answer: "Violeta"
      },
      {
        word: "NEGRO",
        color: "#facc15", // amarillo
        options: ["Amarillo", "Gris", "Negro"],
        answer: "Amarillo"
      }
    ];

    // Estado
    let currentQuestionIndex = 0;
    let questionTimeoutId = null;
    let questionTimerIntervalId = null;
    let preCountdownIntervalId = null;
    let questionStartedAt = null;
    let questionFinished = false;

    const stats = {
      correct: 0,
      wrong: 0,
      timeouts: 0,
      answered: 0,
      totalTime: 0
    };

    const screen = document.getElementById("screen");
    const feedbackToast = document.getElementById("feedback");

    // ===============================
    // UTILIDADES
    // ===============================
    function clearAllTimers() {
      if (questionTimeoutId) clearTimeout(questionTimeoutId);
      if (questionTimerIntervalId) clearInterval(questionTimerIntervalId);
      if (preCountdownIntervalId) clearInterval(preCountdownIntervalId);
      questionTimeoutId = questionTimerIntervalId = preCountdownIntervalId = null;
    }

    function showFeedback(message, type = "default") {
      feedbackToast.textContent = message;
      feedbackToast.className = "feedback show";
      if (type === "success") feedbackToast.classList.add("success");
      if (type === "error") feedbackToast.classList.add("error");
      clearTimeout(showFeedback._t);
      showFeedback._t = setTimeout(() => {
        feedbackToast.className = "feedback";
      }, 1200);
    }

    function formatSeconds(sec) {
      return sec.toFixed(2).replace(".", ",");
    }

    // ===============================
    // RENDERIZADO DE PANTALLAS
    // ===============================
    function renderIntro() {
      clearAllTimers();
      const wrapper = document.createElement("div");
      wrapper.className = "screen";

      wrapper.innerHTML = `
        <header class="top-bar">
        </header>
        <section class="screen-body">
          <h1 class="template">Juego de agilidad mental</h1>
          <p style="margin: 18px 10px;">
            Selecciona el <strong>color correcto de la palabra</strong> antes de que se acabe el tiempo.
            Solo tienes <strong>3 segundos</strong> para responder cada pregunta.
          </p>
          <button class="btn-main" id="btnStart">Iniciar</button>
        </section>
      `;
      screen.innerHTML = "";
      screen.appendChild(wrapper);

      document.getElementById("btnStart").addEventListener("click", () => {
        renderPreCountdown();
      });
    }

    function renderPreCountdown() {
      clearAllTimers();
      const wrapper = document.createElement("div");
      wrapper.className = "screen";

      wrapper.innerHTML = `
        <header class="top-bar">
        </header>
        <section class="screen-body">
          <h2 class="intro-title">¡Prepárate!</h2>
          <p class="intro-subtitle">
            El juego comenzará en unos segundos. Concéntrate y elige el color correcto de cada palabra.
          </p>
          <div class="countdown-number" id="preCount">3</div>
        </section>
      `;
      screen.innerHTML = "";
      screen.appendChild(wrapper);

      let remaining = 3;
      const preCountEl = document.getElementById("preCount");
      preCountdownIntervalId = setInterval(() => {
        remaining--;
        if (remaining <= 0) {
          clearInterval(preCountdownIntervalId);
          preCountdownIntervalId = null;
          startQuiz();
        } else {
          preCountEl.textContent = String(remaining);
          preCountEl.classList.remove("animate");
          void preCountEl.offsetWidth; // reflow
          preCountEl.classList.add("animate");
        }
      }, 1000);
    }

    function startQuiz() {
      currentQuestionIndex = 0;
      stats.correct = stats.wrong = stats.timeouts = stats.answered = stats.totalTime = 0;
      renderQuestion();
    }

    function renderQuestion() {
      clearAllTimers();
      questionFinished = false;

      const q = QUESTIONS[currentQuestionIndex];
      const total = QUESTIONS.length;
      const current = currentQuestionIndex + 1;

      const wrapper = document.createElement("div");
      wrapper.className = "screen";

      wrapper.innerHTML = `
        <header class="top-bar has-title">
        <div class="top-bar-title template">Juego de agilidad mental</div>
        </header>
        <div class="divider"></div>
        <section class="screen-body question-layout">
          <div class="status-bar">
            <div>
              <div class="progress-label">Pregunta ${current} de ${total}</div>
              <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
              </div>
            </div>
            <div class="timer">
              <span>Tiempo:</span>
              <span class="timer-number" id="timerNumber">${QUESTION_TIME}</span>s
              <div class="timer-bar">
                <div class="timer-fill" id="timerFill"></div>
              </div>
            </div>
          </div>

          <div class="question-word-box">
            <div class="question-word" id="questionWord">${q.word}</div>
          </div>

          <div class="options-grid" id="optionsGrid"></div>

          <div class="question-footer">
            Responde antes de que la barra llegue a cero.
          </div>
        </section>
      `;
      screen.innerHTML = "";
      screen.appendChild(wrapper);

      // Colorear palabra
      const wordEl = document.getElementById("questionWord");
      wordEl.style.color = q.color;

      // Progreso general
      const progressFill = document.getElementById("progressFill");
      const progressPct = (current / total) * 100;
      progressFill.style.width = progressPct + "%";

      // Opciones
      const optionsGrid = document.getElementById("optionsGrid");
      q.options.forEach((opt) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = opt;
        btn.addEventListener("click", () => handleAnswer(btn, opt));
        optionsGrid.appendChild(btn);
      });

      // Temporizador visual + numérico
      const timerNumberEl = document.getElementById("timerNumber");
      const timerFillEl = document.getElementById("timerFill");

      // animación de barra
      timerFillEl.style.width = "100%";
      setTimeout(() => {
        timerFillEl.style.width = "0%";
      }, 40);

      let remaining = QUESTION_TIME;
      timerNumberEl.textContent = remaining;

      questionStartedAt = Date.now();

      questionTimerIntervalId = setInterval(() => {
        remaining -= 1;
        if (remaining <= 0) {
          clearInterval(questionTimerIntervalId);
          questionTimerIntervalId = null;
        }
        timerNumberEl.textContent = Math.max(remaining, 0);
      }, 1000);

      // Tiempo límite lógico
      questionTimeoutId = setTimeout(() => {
        if (!questionFinished) {
          handleTimeout();
        }
      }, QUESTION_TIME * 1000);
    }

    function handleAnswer(buttonEl, chosen) {
      if (questionFinished) return;
      questionFinished = true;
      clearAllTimers();

      const q = QUESTIONS[currentQuestionIndex];
      const buttons = Array.from(document.querySelectorAll(".option-btn"));

      const isCorrect = chosen === q.answer;

      const elapsed = (Date.now() - questionStartedAt) / 1000;
      stats.answered++;
      stats.totalTime += elapsed;

      if (isCorrect) {
        stats.correct++;
      } else {
        stats.wrong++;
      }

      buttons.forEach((btn) => {
        const value = btn.textContent.trim();
        if (value === q.answer) {
          btn.classList.add("correct");
        }
        if (btn === buttonEl && !isCorrect) {
          btn.classList.add("wrong");
        }
        btn.disabled = true;
      });

      showFeedback(
        isCorrect ? "¡Correcto!" : "Respuesta incorrecta",
        isCorrect ? "success" : "error"
      );

      setTimeout(nextStep, 900);
    }

    function handleTimeout() {
      if (questionFinished) return;
      questionFinished = true;

      stats.timeouts++;
      stats.wrong++;

      const q = QUESTIONS[currentQuestionIndex];
      const buttons = Array.from(document.querySelectorAll(".option-btn"));

      buttons.forEach((btn) => {
        const value = btn.textContent.trim();
        if (value === q.answer) {
          btn.classList.add("correct");
        }
        btn.disabled = true;
      });

      showFeedback("¡Tiempo agotado!", "error");
      setTimeout(nextStep, 900);
    }

    function nextStep() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= QUESTIONS.length) {
        renderResults();
      } else {
        renderQuestion();
      }
    }

    function renderResults() {
      clearAllTimers();

      const total = QUESTIONS.length;
      const { correct, wrong, timeouts, answered, totalTime } = stats;
      const avgTime = answered > 0 ? totalTime / answered : 0;

      const wrapper = document.createElement("div");
      wrapper.className = "screen";

      wrapper.innerHTML = `
        <header class="top-bar">
        </header>
        <section class="screen-body">
          <h1 class="template">Resultados del juego</h1>
          <p class="results-text">
            Has completado el juego de agilidad mental.
            Revisa tus resultados y vuelve a intentarlo para mejorar tu tiempo y precisión.
          </p>

          <div class="results-grid">
            <div class="result-card">
              <strong>${correct}/${total}</strong>
              Aciertos
            </div>
            <div class="result-card">
              <strong>${wrong}</strong>
              Respuestas incorrectas
            </div>
            <div class="result-card">
              <strong>${timeouts}</strong>
              Veces sin responder a tiempo
            </div>
            <div class="result-card">
              <strong>${answered > 0 ? formatSeconds(avgTime) + " s" : "-"}</strong>
              Tiempo medio por respuesta
            </div>
          </div>

          <button class="btn-secondary" id="btnRestart">Volver a jugar</button>
        </section>
      `;
      screen.innerHTML = "";
      screen.appendChild(wrapper);

      document.getElementById("btnRestart").addEventListener("click", () => {
        currentQuestionIndex = 0;
        startQuiz();
      });
    }

    renderIntro();
  </script>
</body>

</html>